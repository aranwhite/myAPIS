{
  "goid": "bf11f5ae8d34581f62ca34db6d9868fc",
  "guid": "72e74c01-fe4d-4c01-867a-d0b8133efc7a",
  "name": "getJWT",
  "resolutionPath": "/custom/spi/getjwt*",
  "checksum": "c8c1e69a33856fcaa5fc0043be07700fea495fa8",
  "enabled": true,
  "folderPath": "/CR2Demos",
  "methodsAllowed": [
    "GET",
    "POST",
    "PUT",
    "DELETE"
  ],
  "tracingEnabled": false,
  "wssProcessingEnabled": false,
  "policy": {
    "xml": "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<wsp:Policy xmlns:L7p=\"http://www.layer7tech.com/ws/policy\" xmlns:wsp=\"http://schemas.xmlsoap.org/ws/2002/12/policy\">\n    <wsp:All wsp:Usage=\"Required\">\n        <wsp:OneOrMore L7p:Enabled=\"false\" wsp:Usage=\"Required\">\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:RateLimit>\n                    <L7p:CounterName stringValue=\"PRESET(9dcca14246e73e4b)${request.clientid}\"/>\n                    <L7p:MaxConcurrency stringValue=\"5\"/>\n                    <L7p:MaxRequestsPerSecond stringValue=\"2\"/>\n                    <L7p:ShapeRequests booleanValue=\"true\"/>\n                </L7p:RateLimit>\n            </wsp:All>\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:HardcodedResponse>\n                    <L7p:Base64ResponseBody stringValue=\"ewogICAgIkVycm9yIiA6ICIgSldUIEdlbmVyYXRpb24gRmFpbHVyZSIsCiAgICAiRGVzY3JpcHRvbiIgOiAiRXhjZWVkZWQgUmF0ZSBMaW1pdCAtIFBsZWFzZSB0cnkgbGF0ZXIuIgp9\"/>\n                    <L7p:ResponseContentType stringValue=\"application/json; charset=UTF-8\"/>\n                    <L7p:ResponseStatus stringValue=\"500\"/>\n                </L7p:HardcodedResponse>\n            </wsp:All>\n        </wsp:OneOrMore>\n        <L7p:SetVariable>\n            <L7p:Base64Expression stringValue=\"cHJvdmlkZXIx\"/>\n            <L7p:VariableToSet stringValue=\"key\"/>\n        </L7p:SetVariable>\n        <L7p:SetVariable>\n            <L7p:Base64Expression stringValue=\"cHJvdmlkZXIy\"/>\n            <L7p:VariableToSet stringValue=\"key2\"/>\n        </L7p:SetVariable>\n        <wsp:OneOrMore wsp:Usage=\"Required\">\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:SslAssertion/>\n                <L7p:HttpBasic/>\n                <L7p:Authentication>\n                    <L7p:IdentityProviderOid goidValue=\"0000000000000000fffffffffffffffe\"/>\n                </L7p:Authentication>\n                <L7p:SetVariable>\n                    <L7p:AssertionComment assertionComment=\"included\">\n                        <L7p:Properties mapValue=\"included\">\n                            <L7p:entry>\n                                <L7p:key stringValue=\"LEFT.COMMENT\"/>\n                                <L7p:value stringValue=\"==\"/>\n                            </L7p:entry>\n                            <L7p:entry>\n                                <L7p:key stringValue=\"RIGHT.COMMENT\"/>\n                                <L7p:value stringValue=\"// Issuer Identifier (including protocol and port)\"/>\n                            </L7p:entry>\n                        </L7p:Properties>\n                    </L7p:AssertionComment>\n                    <L7p:Base64Expression stringValue=\"aHR0cHM6Ly8ke2dhdGV3YXkuY2x1c3Rlci5ob3N0bmFtZX0=\"/>\n                    <L7p:VariableToSet stringValue=\"iss\"/>\n                </L7p:SetVariable>\n                <L7p:CommentAssertion>\n                    <L7p:Comment stringValue=\"Currently using single key but based on incoming app, this may be converted into dynamic key selection.\"/>\n                </L7p:CommentAssertion>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"eyJraWQiOiAic3NsIn0=\"/>\n                    <L7p:VariableToSet stringValue=\"kid\"/>\n                </L7p:SetVariable>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"MzYwMA==\"/>\n                    <L7p:VariableToSet stringValue=\"jwt.age\"/>\n                </L7p:SetVariable>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"JHtnYXRld2F5LnRpbWUuc2Vjb25kc30=\"/>\n                    <L7p:DataType variableDataType=\"dateTime\"/>\n                    <L7p:DateOffsetExpression stringValue=\"${jwt.age}\"/>\n                    <L7p:VariableToSet stringValue=\"jwt.exp\"/>\n                </L7p:SetVariable>\n                <L7p:SetVariable>\n                    <L7p:Base64Expression stringValue=\"ew0KICAic3ViIjogIiR7cmVxdWVzdC5hdXRoZW50aWNhdGVkdXNlcn0iLA0KICAiZXhwIjogJHtqd3QuZXhwLnNlY29uZHN9LA0KICAiaWF0IjogIiR7Z2F0ZXdheS50aW1lLnNlY29uZHN9IiwNCiAgImlzcyI6ICAiJHtpc3N9IiwNCiAgImFwcCI6ICAiJHtyZXF1ZXN0Lmh0dHAucGFyYW1ldGVyLmFwcH0iLA0KICAiY2xpZW50X2lkIjogIiR7cmVxdWVzdC5odHRwLnBhcmFtZXRlci5jbGllbnRfaWR9IiwNCiAgIkN1c3RvbSBTUEkiOiB0cnVlDQp9\"/>\n                    <L7p:VariableToSet stringValue=\"jwt.payload\"/>\n                </L7p:SetVariable>\n                <wsp:OneOrMore wsp:Usage=\"Required\">\n                    <wsp:All wsp:Usage=\"Required\">\n                        <L7p:ComparisonAssertion>\n                            <L7p:Expression1 stringValue=\"${request.http.parameter.action}\"/>\n                            <L7p:Expression2 stringValue=\"encode\"/>\n                            <L7p:Predicates predicates=\"included\">\n                                <L7p:item binary=\"included\">\n                                    <L7p:RightValue stringValue=\"encode\"/>\n                                </L7p:item>\n                            </L7p:Predicates>\n                        </L7p:ComparisonAssertion>\n                        <L7p:EncodeJsonWebToken>\n                            <L7p:DynamicPrivateKeyAliasVariable stringValue=\"${key}\"/>\n                            <L7p:HeaderAction stringValue=\"Merge to Generated Header\"/>\n                            <L7p:SignPayload booleanValue=\"true\"/>\n                            <L7p:SignatureAlgorithm stringValue=\"RS512\"/>\n                            <L7p:SignatureSourceType intValue=\"3\"/>\n                            <L7p:SourceHeaders stringValue=\"${kid}\"/>\n                            <L7p:SourceVariable stringValue=\"${jwt.payload}\"/>\n                            <L7p:TargetVariable stringValue=\"jwt.token\"/>\n                        </L7p:EncodeJsonWebToken>\n                        <L7p:HardcodedResponse>\n                            <L7p:Base64ResponseBody stringValue=\"ewogICAiand0IjogIiR7and0LnRva2VuLmNvbXBhY3R9Igp9\"/>\n                            <L7p:ResponseContentType stringValue=\"application/json; charset=UTF-8\"/>\n                        </L7p:HardcodedResponse>\n                    </wsp:All>\n                    <wsp:All wsp:Usage=\"Required\">\n                        <L7p:ComparisonAssertion>\n                            <L7p:Expression1 stringValue=\"${request.http.parameter.action}\"/>\n                            <L7p:Expression2 stringValue=\"decode\"/>\n                            <L7p:Predicates predicates=\"included\">\n                                <L7p:item binary=\"included\">\n                                    <L7p:RightValue stringValue=\"decode\"/>\n                                </L7p:item>\n                            </L7p:Predicates>\n                        </L7p:ComparisonAssertion>\n                        <L7p:EncodeJsonWebToken>\n                            <L7p:ContentEncryptionAlgorithm stringValue=\"A128CBC-HS256\"/>\n                            <L7p:DynamicPrivateKeyAliasVariable stringValue=\"${key}\"/>\n                            <L7p:EncryptPayload booleanValue=\"true\"/>\n                            <L7p:EncryptionKey stringValue=\"key\"/>\n                            <L7p:EncryptionKeyType stringValue=\"Certificate\"/>\n                            <L7p:EncryptionSourceType intValue=\"2\"/>\n                            <L7p:HeaderAction stringValue=\"Merge to Generated Header\"/>\n                            <L7p:KeyManagementAlgorithm stringValue=\"RSA-OAEP\"/>\n                            <L7p:SignPayload booleanValue=\"true\"/>\n                            <L7p:SignatureAlgorithm stringValue=\"RS512\"/>\n                            <L7p:SignatureSourceType intValue=\"3\"/>\n                            <L7p:SourceHeaders stringValue=\"${kid}\"/>\n                            <L7p:SourceVariable stringValue=\"${jwt.payload}\"/>\n                            <L7p:TargetVariable stringValue=\"jwt.token\"/>\n                        </L7p:EncodeJsonWebToken>\n                        <L7p:DecodeJsonWebToken>\n                            <L7p:DetachedJwsContent stringValue=\"\"/>\n                            <L7p:DynamicPrivateKeyVariable stringValue=\"${key}\"/>\n                            <L7p:FailUnverifiedSignature booleanValue=\"true\"/>\n                            <L7p:SourcePayload stringValue=\"${jwt.token.compact}\"/>\n                            <L7p:TargetVariablePrefix stringValue=\"test\"/>\n                            <L7p:ValidationType stringValue=\"Using Recipient Key Alias From Context Variable\"/>\n                        </L7p:DecodeJsonWebToken>\n                        <L7p:HardcodedResponse>\n                            <L7p:Base64ResponseBody stringValue=\"JHt0ZXN0LnBheWxvYWR9\"/>\n                            <L7p:ResponseContentType stringValue=\"application/json; charset=UTF-8\"/>\n                        </L7p:HardcodedResponse>\n                    </wsp:All>\n                </wsp:OneOrMore>\n            </wsp:All>\n            <wsp:All wsp:Usage=\"Required\">\n                <L7p:CustomizeErrorResponse>\n                    <L7p:Content stringValueReference=\"inline\"><![CDATA[{\n    \"Error\" : \" JWT Generation Failure\",\n   \"Descripton\" : \"Not a valid User - Please check and try again.\"\n}]]></L7p:Content>\n                    <L7p:ContentType stringValue=\"application/json; charset=UTF-8\"/>\n                    <L7p:Enabled booleanValue=\"false\"/>\n                    <L7p:ExtraHeaders nameValuePairArray=\"included\">\n                        <L7p:item nameValuePair=\"included\">\n                            <L7p:Key stringValue=\"x.broadcom.error\"/>\n                            <L7p:Value stringValue=\"Request Failer\"/>\n                        </L7p:item>\n                    </L7p:ExtraHeaders>\n                </L7p:CustomizeErrorResponse>\n                <L7p:RaiseError>\n                    <L7p:Enabled booleanValue=\"false\"/>\n                </L7p:RaiseError>\n                <L7p:HardcodedResponse>\n                    <L7p:Base64ResponseBody stringValue=\"ewogICAgIkVycm9yIiA6ICIgSldUIEdlbmVyYXRpb24gRmFpbHVyZSIsCiAgICJEZXNjcmlwdG9uIiA6ICJOb3QgYSB2YWxpZCBVc2VyIC0gUGxlYXNlIGNoZWNrIGFuZCB0cnkgYWdhaW4uIgp9\"/>\n                    <L7p:ResponseContentType stringValue=\"application/json; charset=UTF-8\"/>\n                    <L7p:ResponseStatus stringValue=\"401\"/>\n                </L7p:HardcodedResponse>\n            </wsp:All>\n        </wsp:OneOrMore>\n    </wsp:All>\n</wsp:Policy>\n"
  }
}